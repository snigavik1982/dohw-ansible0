- name: Copy system hosts file
  copy:
    src: hosts
    dest: /etc/hosts
- name: Install RabbitMQ
  yum:
    name: rabbitmq-server
    state: present
- name: Configure RabbitMQ - reverse dns lookup
  replace:
    path: /etc/rabbitmq/rabbitmq.config
    regexp: '%%\ \{reverse_dns_lookups,\ true\},'
    replace: '{reverse_dns_lookups, false},'
- name: Configure RabbitMQ - guest connect
  replace:
    path: /etc/rabbitmq/rabbitmq.config
    regexp: '%%\ \{loopback_users,\ \[\]\},'
    replace: '{loopback_users, []}'
- name: Configure RabbitMQ - management API enable
  shell: /usr/sbin/rabbitmq-plugins enable rabbitmq_management
