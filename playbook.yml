---
# Ansible Playbook for Devops Homework by skuzaev.
# Ir provisions CENTRAL and WORKER* VM's.
# CENTRAL runs RabbitMQ for queue, and Ganglia and Nagios for performance
# monitoring and alerting.
# WORKER* run Pyhton App to consume messages form queue.
# See individual role files and attached README for more details.
#
- hosts: central
  remote_user: root
  roles:
    - rabbitmq-server
    - central-app
    - ganglia-central
    - nagios
  tasks:
  - name: Enable Ganglia gmetad
    service:
      name: gmetad
      state: started
      enabled: yes
  - name: Enable Ganglia gmond
    service:
      name: gmond
      state: started
      enabled: yes
  - name: Enable HTTPD
    service:
      name: httpd
      state: started
      enabled: yes

- hosts: workers
  remote_user: root
  roles:
    - worker-app
    - ganglia-worker
  tasks:
  - name: Enable Ganglia gmond
    service:
      name: gmond
      state: started
      enabled: yes
  - name: Enable Worker-App
    service:
      name: urbunny-receiver
      state: started
      enabled: yes
...
